<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-05-29">

<title>Multivariate Analysis Lecture 13: LDA for Multi-Class Problems</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="LDA_MultiClass_Details_AnExample_files/libs/clipboard/clipboard.min.js"></script>
<script src="LDA_MultiClass_Details_AnExample_files/libs/quarto-html/quarto.js"></script>
<script src="LDA_MultiClass_Details_AnExample_files/libs/quarto-html/popper.min.js"></script>
<script src="LDA_MultiClass_Details_AnExample_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="LDA_MultiClass_Details_AnExample_files/libs/quarto-html/anchor.min.js"></script>
<link href="LDA_MultiClass_Details_AnExample_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="LDA_MultiClass_Details_AnExample_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="LDA_MultiClass_Details_AnExample_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="LDA_MultiClass_Details_AnExample_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="LDA_MultiClass_Details_AnExample_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
</head><body class="fullcontent">\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{footline}[page number]
\usepackage{amsmath}

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>





<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Multivariate Analysis Lecture 13: LDA for Multi-Class Problems</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p> </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 29, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="summary-of-lda" class="level1">
<h1>Summary of LDA</h1>
<section id="linear-discriminant-analysis" class="level3">
<h3 class="anchored" data-anchor-id="linear-discriminant-analysis">Linear Discriminant Analysis</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"img/FLDA.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="img/FLDA.png" class="img-fluid" style="width:70.0%"></p>
</div>
</div>
</section>
<section id="lda-for-multi-class-problems" class="level3">
<h3 class="anchored" data-anchor-id="lda-for-multi-class-problems">LDA for Multi-Class Problems</h3>
<ul>
<li>Fisher 1936 proposed a dichotomous discriminant analysis</li>
<li>Fisherâ€™s linear discriminant function is a function</li>
<li>The linear function has the maximum ability to discriminant between samples</li>
<li>This idea can be extended to multiple groups</li>
<li>We are going to show the details and an example</li>
</ul>
</section>
</section>
<section id="multi-class-lda" class="level1">
<h1>Multi-Class LDA</h1>
<section id="extend-flda-to-g-classes" class="level3">
<h3 class="anchored" data-anchor-id="extend-flda-to-g-classes">Extend FLDA to <span class="math inline">\(g\)</span> Classes</h3>
<ul>
<li><p>Consider <span class="math inline">\(g\)</span> classes. We have <span class="math inline">\(g\)</span> independent random samples: <span class="math display">\[\begin{aligned}
X_{1j} &amp; \overset{iid}\sim (\mu_1, \Sigma), j=1, \cdots, n_1\\
X_{2j} &amp; \overset{iid}\sim (\mu_2, \Sigma), j=1, \cdots, n_2\\
\cdots &amp; \cdots \\
X_{gj} &amp; \overset{iid}\sim (\mu_g, \Sigma), j=1, \cdots, n_g
\end{aligned}\]</span></p></li>
<li><p>Let <span class="math inline">\(n=\sum_{i=1}^{g} \sum_{j=1}^{n_i}\)</span>, i.e., <span class="math inline">\(n\)</span> is the total sample size / total number of observations.</p></li>
<li><p>Let <span class="math inline">\(X_{ij} \in \mathbb R^p\)</span> denote the <span class="math inline">\(j\)</span>th observation from the <span class="math inline">\(i\)</span>the class. The first linear discriminant aims to find a linear function <span class="math inline">\(Y_{ij}^{(1)}=a^T X_{ij}\)</span> that leads to separation</p></li>
</ul>
</section>
<section id="quantify-separation-in-a-g-class-problem" class="level3">
<h3 class="anchored" data-anchor-id="quantify-separation-in-a-g-class-problem">Quantify Separation in a <span class="math inline">\(g\)</span>-Class Problem</h3>
<ul>
<li>Measure separation using F statistic</li>
</ul>
<p><span class="math display">\[\begin{aligned}
F(a) &amp;= \frac{MSB}{MSW}=\frac{SSB/(g-1)}{SSW/(n-g)}\\
&amp;= \frac{\sum_{i=1}^g n_i (\bar Y_{i.}^{(1)} -\bar Y_{..}^{(1)})^2/(g-1)}{\sum_{i=1}^g (n_i-1)S_{Y_i^{(1)}}^2/(n-g)}\\
&amp;=\frac{a^T \sum n_i (\bar X_{i.} -\bar X_{..})(\bar X_{i.}-\bar X_{..})^T a}{a^T \sum_{i=1}^g\sum_{j=1}^{n_i} (X_{ij} -\bar X_{i.})(X_{ij}-\bar X_{i.})^T a}\frac{n-g}{g-1}\\
&amp;= \frac{a^T \mathbf B a}{a^T \mathbf W a}\frac{n-g}{g-1}
\end{aligned}\]</span> where <span class="math inline">\(n=\sum_{i=1}^g n_i\)</span>, <span class="math inline">\(\mathbf B\)</span> is the between-group sample covariance matrix, and <span class="math inline">\(\mathbf W\)</span> is the within-group sample covariance matrix.</p>
</section>
<section id="linear-discriminants---the-maximization-problem" class="level3">
<h3 class="anchored" data-anchor-id="linear-discriminants---the-maximization-problem">Linear Discriminants - The Maximization Problem</h3>
<ul>
<li><p>The first linear discriminant (LD) is the linear function that maximizes <span class="math inline">\(F(a)\)</span>. Let <span class="math inline">\(a_1\)</span> denote the coefficients corresponding to the first LD. Then <span class="math display">\[a_1 = \underset{a^T S_{pooled} a=1 } {\operatorname*{argmax}} F(a)\]</span></p></li>
<li><p>The second LD, the coefficients of which are denoted by <span class="math inline">\(a_2\)</span>, satisfies <span class="math display">\[a_2 = \underset{a^T S_{pooled} a=1, a^T S_{pooled} a_1=0 } {\operatorname*{argmax}} F(a)\]</span></p></li>
<li><p>The rest of LDs are similarly defined</p></li>
<li><p>Note that the scale of <span class="math inline">\(a_k\)</span> does not matter, as it will be cancelled when taking the ratio of the numerator to the denominator. We use this constraint so that later we can simply use Euclidean distances in the projected space.</p></li>
</ul>
</section>
<section id="linear-discriminants-the-coefficients" class="level3">
<h3 class="anchored" data-anchor-id="linear-discriminants-the-coefficients">Linear Discriminants: The Coefficients</h3>
<ul>
<li><p>It can be shown that the <span class="math inline">\(a_k\)</span> is proportional to the <span class="math inline">\(k\)</span>th eigenvector of <span class="math inline">\(\mathbf W^{-1}\mathbf B\)</span>. We rescale it such that <span class="math inline">\(a_k^T S_{pooled}a_k=1\)</span>; as a result, <span class="math display">\[a_k = \frac{\gamma_k}{\sqrt{\gamma_k^T S_{pooled}\gamma_k}}\]</span></p></li>
<li><p>Let <span class="math inline">\(\gamma_k\)</span> denote the <span class="math inline">\(k\)</span>th eigenvetor of <span class="math inline">\(\mathbf W^{-1}\mathbf B\)</span>. Note the eigenvectors are not necessarily orthogonal because <span class="math inline">\(\mathbf W^{-1}\mathbf B\)</span> is not necessarily symmetric.</p></li>
<li><p>We have shown earlier that <span class="math inline">\(rank(\mathbf W^{-1}\mathbf B)=min(g-1, p)\)</span>. Let <span class="math inline">\(r\)</span> denote <span class="math inline">\(rank(\mathbf W^{-1}\mathbf B)\)</span>. Then there are <span class="math inline">\(r\)</span> LDs.</p></li>
</ul>
</section>
<section id="linear-discriminants" class="level3">
<h3 class="anchored" data-anchor-id="linear-discriminants">Linear Discriminants</h3>
<ul>
<li><p>Letâ€™s consider a more compact/implementable presentation of the result. Let <span class="math inline">\(\mathbf X_{n\times p}\)</span> be the data matrix for the <span class="math inline">\(n\)</span> observations, each with <span class="math inline">\(p\)</span> features.</p></li>
<li><p>The <span class="math inline">\(k\)</span>th LD, denoted by <span class="math inline">\(Y^{(k)}\)</span>, which is an <span class="math inline">\(n\times 1\)</span> vector. It can be obtained by <span class="math display">\[Y^{(k)}=\mathbf X a_k\]</span></p></li>
<li><p>Note that <span class="math inline">\(Y^{(k)}\)</span>â€™s have the same spooled variance because <span class="math display">\[s^2_{k, pooled}= a_k^T S_{pooled} a_k =1\]</span></p></li>
<li><p>They are also uncorrelated (also independent if multivariate normality holds) because for <span class="math inline">\(k\not=k'\)</span> <span class="math display">\[cor(Y^{(k)}, Y^{(k')})=a_k^T \Sigma a_{k'}\overset{estiamte}=a_k^T S_{pooled} a_{k'}=0\]</span></p></li>
<li><p>Thus, it makes sense to use the Euclidean distance in the projected space</p></li>
</ul>
</section>
<section id="use-top-lds-for-discrimination" class="level3">
<h3 class="anchored" data-anchor-id="use-top-lds-for-discrimination">Use top LDs for discrimination</h3>
<ul>
<li><p>The first LD has the best ability to discriminant the classes. The <span class="math inline">\(r\)</span>th LD has the poorest ability.</p></li>
<li><p>Suppose that we decide to use top <span class="math inline">\(T\)</span> LDs. We first combine the LDs into an <span class="math inline">\(n\times T\)</span> matrix <span class="math display">\[\tilde Y =(Y^{(1)}, \cdots, Y^{(T)})= \mathbf X (a_1, \cdots, a_T)\]</span></p></li>
<li><p>Next, we compute the centers of the classes in the <span class="math inline">\(\mathbb R^T\)</span> space, denoted by <span class="math inline">\(\tilde Y_1, \cdots, \tilde Y_g\)</span>, with <span class="math inline">\(\tilde Y_i= \bar {\mathbf X}_1 (a_1, \cdots, a_T)\)</span></p></li>
<li><p>Let <span class="math inline">\(x_0\in \mathbb R^p\)</span> denote a data point to be allocated.</p></li>
<li><p>We first project <span class="math inline">\(x_0\in \mathbb R^p\)</span> to a vector of the LDs, denoted by <span class="math inline">\(y_0\in \mathbb R^T\)</span>. This can be done by <span class="math inline">\(y_0=x_0^T (a_1, \cdots, a_T)\)</span></p></li>
<li><p>we then compute its squared Euclidean distance to each center <span class="math display">\[||y_0-\tilde Y_i||^2=(y_0-\tilde Y_i)^T(y_0-\tilde Y_i)  \]</span></p></li>
<li><p>We allocate <span class="math inline">\(x\)</span> to the class based on the nearest distance rule.</p></li>
</ul>
</section>
<section id="linear-discriminants-when-using-all-the-lds" class="level3">
<h3 class="anchored" data-anchor-id="linear-discriminants-when-using-all-the-lds">Linear Discriminants: When Using All the LDs</h3>
<ul>
<li><p>Let <span class="math inline">\(A=(a_1, \cdots, a_r)\)</span> where <span class="math inline">\(r=rank(W^{-1}B)\)</span>. Note <span class="math inline">\(A\)</span> is a <span class="math inline">\(p\times r\)</span> matrix that transforms the original features to <span class="math inline">\(r\)</span> LD features.</p></li>
<li><p>When using all the LDs, we have <span class="math inline">\(\tilde Y = \mathbf X A\)</span>, where <span class="math inline">\(\tilde Y\)</span> is <span class="math inline">\(n\times r\)</span>.</p></li>
<li><p>Consider <span class="math inline">\(x_0\)</span>, the data point to be classified and <span class="math inline">\(x\)</span>, an arbitrary point. In the original feature space, the squared statistical distance is <span class="math display">\[D_{S_{pooled}}^2(x_0, x)=(x_0-x)^T S_{pooled}^{-1} (x_0 -x)\]</span></p></li>
<li><p>We transform/ project <span class="math inline">\(x_0\)</span> and <span class="math inline">\(x\)</span> to the space of the LDs by computing <span class="math inline">\(y_0=A^Tx_0 \mbox{ and } y=A^Tx\)</span> both are <span class="math inline">\(r\times 1\)</span> vectors. Their squared Euclidean distance is</p></li>
</ul>
<p><span class="math display">\[D(y_0, y)=(x_0-x)^T A A^T (x_0-x)\]</span></p>
</section>
<section id="linear-discriminants-when-using-all-the-lds-1" class="level3">
<h3 class="anchored" data-anchor-id="linear-discriminants-when-using-all-the-lds-1">Linear Discriminants: When Using All the LDs</h3>
<ul>
<li>Next, letâ€™s examine what is <span class="math inline">\(AA^T\)</span>.</li>
<li>Recall that <span class="math inline">\(a_k\)</span> is proportional to the <span class="math inline">\(k\)</span>th eigenvector of <span class="math inline">\(W^{-1}B\)</span>. Thus, it satisfies <span class="math inline">\(W^{-1}Ba_k=\lambda_k a_k\)</span>, which can be rewritten to <span class="math display">\[(n-p)^{-1}S_{pooled}^{-1/2}BS_{pooled}^{-1/2}S_{pooled}^{1/2}a_k=\lambda_k S_{pooled}^{1/2}a_k\]</span></li>
<li>Let <span class="math inline">\(b=S_{pooled}^{1/2}a_k\)</span>, we have <span class="math display">\[S_{pooled}^{-1/2}BS_{pooled}^{-1/2} b = [\lambda_k(n-p)]b\]</span> Thus, <span class="math inline">\(b_k\)</span>â€™s are the eigenvectors of a symmetric matrix. As a result, <span class="math inline">\(b_k\)</span>â€™s are orthogonal with each other.</li>
</ul>
</section>
<section id="linear-discriminants-when-using-all-the-lds-2" class="level3">
<h3 class="anchored" data-anchor-id="linear-discriminants-when-using-all-the-lds-2">Linear Discriminants: When Using All the LDs</h3>
<ul>
<li><p>Note that <span class="math inline">\(a_k=S_{pooled}^{-1/2} b_k\)</span>. Use the results about <span class="math inline">\(b_k\)</span>â€™s, we have <span class="math display">\[(AA^T)_{ij}=\sum_{k=1}^r a_k a_k^T=S_{pooled}^{-1/2} \sum_{k=1}^r b_k b_k^TS_{pooled}^{-1/2}=S_{pooled}^{-1}\]</span></p></li>
<li><p>The results indicate that the following two classification rules are the same</p>
<ol type="1">
<li>The minimum distance (Euclidean) rule in the space of all the LDs</li>
<li>The minimal distance (statistical/Mahalanobis) rule using original features</li>
</ol></li>
</ul>
</section>
</section>
<section id="example-iris-data" class="level1">
<h1>Example Iris Data</h1>
<section id="compute-w-and-b" class="level2">
<h2 class="anchored" data-anchor-id="compute-w-and-b">Compute <span class="math inline">\(W\)</span> and <span class="math inline">\(B\)</span></h2>
<section id="iris-data-three-species-two-features-sepall-sepalw" class="level3">
<h3 class="anchored" data-anchor-id="iris-data-three-species-two-features-sepall-sepalw">Iris Data: three species, two features: SepalL SepalW</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>i<span class="ot">=</span><span class="dv">1</span>; j<span class="ot">=</span><span class="dv">2</span> <span class="co">#(Speal L and Sepal W)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>i<span class="ot">=</span><span class="dv">2</span>; j<span class="ot">=</span><span class="dv">3</span> <span class="co">#(Speal W and Petal L)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>x1.bar<span class="ot">=</span><span class="fu">colMeans</span>(iris[<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>,<span class="fu">c</span>(i,j)])</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>x2.bar<span class="ot">=</span><span class="fu">colMeans</span>(iris[<span class="dv">51</span><span class="sc">:</span><span class="dv">100</span>,<span class="fu">c</span>(i,j)])</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>x3.bar<span class="ot">=</span><span class="fu">colMeans</span>(iris[<span class="dv">101</span><span class="sc">:</span><span class="dv">150</span>,<span class="fu">c</span>(i,j)])</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>T<span class="ot">=</span>(<span class="dv">150-1</span>)<span class="sc">*</span><span class="fu">cov</span>(iris[,<span class="fu">c</span>(i,j)])</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>W<span class="ot">=</span>(<span class="dv">50-1</span>)<span class="sc">*</span><span class="fu">cov</span>(iris[<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, <span class="fu">c</span>(i,j)]) <span class="sc">+</span>(<span class="dv">50-1</span>)<span class="sc">*</span><span class="fu">cov</span>(iris[<span class="dv">51</span><span class="sc">:</span><span class="dv">100</span>, <span class="fu">c</span>(i,j)])<span class="sc">+</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">50-1</span>)<span class="sc">*</span><span class="fu">cov</span>(iris[<span class="dv">101</span><span class="sc">:</span><span class="dv">150</span>, <span class="fu">c</span>(i,j)])</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>B<span class="ot">=</span>T<span class="sc">-</span>W</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>s.pooled<span class="ot">=</span>W<span class="sc">/</span>(<span class="dv">150-3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="iris-data-compute-the-lds" class="level3">
<h3 class="anchored" data-anchor-id="iris-data-compute-the-lds">Iris Data: Compute the LDs</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>LDs<span class="ot">=</span><span class="fu">eigen</span>(<span class="fu">solve</span>(W)<span class="sc">%*%</span>B)<span class="sc">$</span>vector</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#rescale them such that t(a_k) S_pooled a_k=1</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>LD1<span class="ot">=</span>LDs[,<span class="dv">1</span>]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>LD1<span class="ot">=</span>LD1<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">t</span>(LD1)<span class="sc">%*%</span>s.pooled<span class="sc">%*%</span>LD1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in LD1/sqrt(t(LD1) %*% s.pooled %*% LD1): Recycling array of length 1 in vector-array arithmetic is deprecated.
  Use c() or as.vector() instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>LD2<span class="ot">=</span>LDs[,<span class="dv">2</span>]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LD2<span class="ot">=</span>LD2<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">t</span>(LD2)<span class="sc">%*%</span>s.pooled<span class="sc">%*%</span>LD2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in LD2/sqrt(t(LD2) %*% s.pooled %*% LD2): Recycling array of length 1 in vector-array arithmetic is deprecated.
  Use c() or as.vector() instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># scores on LD1</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>Y1<span class="ot">=</span><span class="fu">as.matrix</span>(iris[,<span class="fu">c</span>(i,j)])<span class="sc">%*%</span><span class="fu">matrix</span>(LD1, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>Y2<span class="ot">=</span><span class="fu">as.matrix</span>(iris[,<span class="fu">c</span>(i,j)])<span class="sc">%*%</span><span class="fu">matrix</span>(LD2, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># with directions. Note: they are not exactly projections</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># because the length of $a_k$ is not 1</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>Y1.direct<span class="ot">=</span><span class="fu">as.matrix</span>(Y1)<span class="sc">%*%</span><span class="fu">matrix</span>(LD1, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>Y2.direct<span class="ot">=</span><span class="fu">as.matrix</span>(Y2)<span class="sc">%*%</span><span class="fu">matrix</span>(LD2, <span class="dv">1</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="iris-data-the-lds" class="level3">
<h3 class="anchored" data-anchor-id="iris-data-the-lds">Iris Data: the LDs</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#verify that the two LDs have the same pooled s2</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">split</span>(Y1, iris<span class="sc">$</span>Species), var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$setosa
[1] 0.4709355

$versicolor
[1] 0.953692

$virginica
[1] 1.575373</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">split</span>(Y1, iris<span class="sc">$</span>Species), var)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">split</span>(Y2, iris<span class="sc">$</span>Species), var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$setosa
[1] 1.101256

$versicolor
[1] 0.9343671

$virginica
[1] 0.9643773</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">split</span>(Y2, iris<span class="sc">$</span>Species), var)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
</section>
<section id="iris-data-visualize-the-lds" class="level3">
<h3 class="anchored" data-anchor-id="iris-data-visualize-the-lds">Iris Data: Visualize the LDs</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Y1, Y2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="LDA_MultiClass_Details_AnExample_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" style="width:80.0%"></p>
</div>
</div>
</section>
<section id="iris-data-visualize-the-lds-in-the-using-rescaled-lds" class="level3">
<h3 class="anchored" data-anchor-id="iris-data-visualize-the-lds-in-the-using-rescaled-lds">Iris Data: Visualize the LDs in the using rescaled LDs</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(iris3[,i,<span class="dv">1</span>], iris3[,j,<span class="dv">1</span>],  <span class="at">pty=</span><span class="st">"s"</span>, <span class="at">xlab=</span><span class="st">"SepalL"</span>, <span class="at">ylab=</span><span class="st">"SepalW"</span>, </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">11</span>, <span class="dv">30</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">30</span>))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="at">cex=</span><span class="fl">1.2</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(iris3[,i,<span class="dv">2</span>], iris3[,j,<span class="dv">2</span>], <span class="at">col=</span><span class="dv">2</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(iris3[,i,<span class="dv">3</span>], iris3[,j,<span class="dv">3</span>], <span class="at">col=</span><span class="dv">3</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span>LD1[<span class="dv">2</span>]<span class="sc">/</span>LD1[<span class="dv">1</span>], <span class="at">col=</span><span class="st">"blue"</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span>LD2[<span class="dv">2</span>]<span class="sc">/</span>LD2[<span class="dv">1</span>], <span class="at">col=</span><span class="st">"blue"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(<span class="dv">0</span>, <span class="dv">0</span>, LD1[<span class="dv">1</span>], LD1[<span class="dv">2</span>], <span class="at">length =</span> <span class="fl">0.1</span>, <span class="at">angle=</span><span class="dv">15</span>, <span class="at">col=</span><span class="st">"blue"</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(<span class="dv">0</span>, <span class="dv">0</span>, LD2[<span class="dv">1</span>], LD2[<span class="dv">2</span>], <span class="at">length =</span> <span class="fl">0.1</span>, <span class="at">angle=</span><span class="dv">15</span>, <span class="at">col=</span><span class="st">"blue"</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>){  </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">text</span>(<span class="at">x=</span>Y1.direct[m,<span class="dv">1</span>], <span class="at">y=</span>Y1.direct[m,<span class="dv">2</span>], <span class="at">labels=</span><span class="st">"|"</span>, <span class="at">col=</span><span class="dv">1</span>, <span class="at">srt=</span><span class="fu">atan</span>(LD1[<span class="dv">2</span>]<span class="sc">/</span>LD1[<span class="dv">1</span>])<span class="sc">*</span><span class="dv">180</span><span class="sc">/</span>pi, <span class="at">cex=</span><span class="fl">0.5</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">text</span>(<span class="at">x=</span>Y2.direct[m,<span class="dv">1</span>], <span class="at">y=</span>Y2.direct[m,<span class="dv">2</span>], <span class="at">labels=</span><span class="st">"|"</span>, <span class="at">col=</span><span class="dv">1</span>, <span class="at">srt=</span><span class="fu">atan</span>(LD2[<span class="dv">2</span>]<span class="sc">/</span>LD2[<span class="dv">1</span>])<span class="sc">*</span><span class="dv">180</span><span class="sc">/</span>pi, <span class="at">cex=</span><span class="fl">0.5</span>)}</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(m <span class="cf">in</span> <span class="dv">51</span><span class="sc">:</span><span class="dv">100</span>){  </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">text</span>(<span class="at">x=</span>Y1.direct[m,<span class="dv">1</span>], <span class="at">y=</span>Y1.direct[m,<span class="dv">2</span>], <span class="at">labels=</span><span class="st">"|"</span>, <span class="at">col=</span><span class="dv">2</span>, <span class="at">srt=</span><span class="fu">atan</span>(LD1[<span class="dv">2</span>]<span class="sc">/</span>LD1[<span class="dv">1</span>])<span class="sc">*</span><span class="dv">180</span><span class="sc">/</span>pi, <span class="at">cex=</span><span class="fl">0.5</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">text</span>(<span class="at">x=</span>Y2.direct[m,<span class="dv">1</span>], <span class="at">y=</span>Y2.direct[m,<span class="dv">2</span>], <span class="at">labels=</span><span class="st">"|"</span>, <span class="at">col=</span><span class="dv">2</span>, <span class="at">srt=</span><span class="fu">atan</span>(LD2[<span class="dv">2</span>]<span class="sc">/</span>LD2[<span class="dv">1</span>])<span class="sc">*</span><span class="dv">180</span><span class="sc">/</span>pi, <span class="at">cex=</span><span class="fl">0.5</span>)}</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(m <span class="cf">in</span> <span class="dv">101</span><span class="sc">:</span><span class="dv">150</span>){  </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">text</span>(<span class="at">x=</span>Y1.direct[m,<span class="dv">1</span>], <span class="at">y=</span>Y1.direct[m,<span class="dv">2</span>], <span class="at">labels=</span><span class="st">"|"</span>, <span class="at">col=</span><span class="dv">3</span>, <span class="at">srt=</span><span class="fu">atan</span>(LD1[<span class="dv">2</span>]<span class="sc">/</span>LD1[<span class="dv">1</span>])<span class="sc">*</span><span class="dv">180</span><span class="sc">/</span>pi, <span class="at">cex=</span><span class="fl">0.5</span>)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">text</span>(<span class="at">x=</span>Y2.direct[m,<span class="dv">1</span>], <span class="at">y=</span>Y2.direct[m,<span class="dv">2</span>], <span class="at">labels=</span><span class="st">"|"</span>, <span class="at">col=</span><span class="dv">3</span>, <span class="at">srt=</span><span class="fu">atan</span>(LD2[<span class="dv">2</span>]<span class="sc">/</span>LD2[<span class="dv">1</span>])<span class="sc">*</span><span class="dv">180</span><span class="sc">/</span>pi, <span class="at">cex=</span><span class="fl">0.5</span>)}</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span><span class="dv">0</span>, <span class="at">y=</span><span class="fl">1.2</span>, <span class="st">"LD1"</span>, <span class="at">srt=</span><span class="sc">-</span><span class="dv">68</span>, <span class="at">col=</span><span class="st">"blue"</span>)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span><span class="dv">4</span>, <span class="at">y=</span><span class="fl">0.2</span>, <span class="st">"LD2"</span>, <span class="at">srt=</span><span class="sc">-</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="LDA_MultiClass_Details_AnExample_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" style="width:80.0%"></p>
</div>
</div>
<ul>
<li><p>The results do not look like projections. They are not, but proportional. The eigenvectors / coefficients of LDs are rescaled such that the variance for each LD is 1. If we want to show the projected data, we need to required each LD to have norm 1.</p></li>
<li><p>In Assignment 3, you can visualize either the projections or the transformed data based on the rescaled LDs.</p></li>
</ul>
</section>
<section id="minimum-distance-classification-rule" class="level3">
<h3 class="anchored" data-anchor-id="minimum-distance-classification-rule">Minimum Distance Classification Rule</h3>
<ul>
<li>Consider <span class="math inline">\(x_0=[5.5, 3]\)</span></li>
<li>We calculate the distance between the new observation and each three classes using two methods</li>
<li>As shown below, the two approaches give the same distances</li>
<li>Thus, using all LDs is the same as using the original data based on statistical distance</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># consider an example </span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>x0<span class="ot">=</span><span class="fu">c</span>(<span class="fl">5.5</span>, <span class="dv">3</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># statistical distance using original data</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>(x0<span class="sc">-</span>x1.bar)<span class="sc">%*%</span> <span class="fu">solve</span>(s.pooled) <span class="sc">%*%</span> (x0<span class="sc">-</span>x1.bar) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 39.08461</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>(x0<span class="sc">-</span>x2.bar)<span class="sc">%*%</span> <span class="fu">solve</span>(s.pooled) <span class="sc">%*%</span> (x0<span class="sc">-</span>x2.bar) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 106.1023</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>(x0<span class="sc">-</span>x3.bar)<span class="sc">%*%</span> <span class="fu">solve</span>(s.pooled) <span class="sc">%*%</span> (x0<span class="sc">-</span>x3.bar) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 144.4239</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Euclidean distance using LDs</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>(x0<span class="sc">%*%</span>LD1<span class="sc">-</span>x1.bar<span class="sc">%*%</span>LD1)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (x0<span class="sc">%*%</span>LD2<span class="sc">-</span>x1.bar<span class="sc">%*%</span>LD2)<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 39.08461</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>(x0<span class="sc">%*%</span>LD1<span class="sc">-</span>x2.bar<span class="sc">%*%</span>LD1)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (x0<span class="sc">%*%</span>LD2<span class="sc">-</span>x2.bar<span class="sc">%*%</span>LD2)<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 106.1023</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>(x0<span class="sc">%*%</span>LD1<span class="sc">-</span>x3.bar<span class="sc">%*%</span>LD1)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (x0<span class="sc">%*%</span>LD2<span class="sc">-</span>x3.bar<span class="sc">%*%</span>LD2)<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 144.4239</code></pre>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>